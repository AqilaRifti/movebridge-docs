---
sidebar_position: 3
---

# @movebridge/codegen

CLI tool for generating TypeScript bindings from deployed Move modules.

## Installation

```bash
npm install -D @movebridge/codegen
```

## Overview

`@movebridge/codegen` generates fully-typed TypeScript classes from Move module ABIs, enabling:

- **Type-safe contract calls** - Compile-time type checking
- **Auto-completion** - IDE support for function names and parameters
- **Documentation** - JSDoc comments from ABI

## Quick Start

Generate TypeScript bindings from a deployed contract:

```bash
npx movebridge-gen \
  --address 0x1::coin \
  --network testnet \
  --output ./src/types/coin.ts
```

Then use the generated class:

```typescript
import { Movement } from '@movebridge/core';
import { CoinContract } from './types/coin';

const movement = new Movement({ network: 'testnet' });
const coin = new CoinContract(movement);

// Fully typed method calls
const balance = await coin.balance('0x123...', ['0x1::aptos_coin::AptosCoin']);
```

## CLI Usage

```bash
npx movebridge-gen [options]
```

### Options

| Option | Alias | Description | Required |
|--------|-------|-------------|----------|
| `--address` | `-a` | Module address (e.g., `0x1::coin`) | Yes |
| `--network` | `-n` | Network (`mainnet` or `testnet`) | Yes |
| `--output` | `-o` | Output file path | Yes |

### Examples

```bash
# Generate coin module bindings
npx movebridge-gen -a 0x1::coin -n testnet -o ./src/types/coin.ts

# Generate custom contract bindings
npx movebridge-gen \
  --address 0x123abc::my_module \
  --network mainnet \
  --output ./src/contracts/my-module.ts
```

## Generated Code

For a module like this:

```move
module 0x123::counter {
    public fun get_count(): u64 { ... }
    public entry fun increment() { ... }
    public entry fun set_count(value: u64) { ... }
}
```

The generator produces:

```typescript
/**
 * Auto-generated TypeScript bindings for 0x123::counter
 * Generated by @movebridge/codegen
 */
import type { Movement } from '@movebridge/core';

export class CounterContract {
  private readonly movement: Movement;
  private readonly address = '0x123';
  private readonly module = 'counter';

  constructor(movement: Movement) {
    this.movement = movement;
  }

  /**
   * View function: get_count
   * @returns Function result
   */
  async getCount(): Promise<string> {
    const contract = this.movement.contract({
      address: this.address,
      module: this.module,
    });
    return contract.view<string>('get_count', [], []);
  }

  /**
   * Entry function: increment
   * @returns Transaction hash
   */
  async increment(): Promise<string> {
    const contract = this.movement.contract({
      address: this.address,
      module: this.module,
    });
    return contract.call('increment', [], []);
  }

  /**
   * Entry function: set_count
   * @param arg0 - Parameter of type u64
   * @returns Transaction hash
   */
  async setCount(arg0: string): Promise<string> {
    const contract = this.movement.contract({
      address: this.address,
      module: this.module,
    });
    return contract.call('set_count', [arg0], []);
  }
}
```

## Type Mappings

Move types are mapped to TypeScript types:

| Move Type | TypeScript Type |
|-----------|-----------------|
| `bool` | `boolean` |
| `u8`, `u16`, `u32` | `number` |
| `u64`, `u128`, `u256` | `string` |
| `address` | `string` |
| `vector<T>` | `T[]` |
| `0x1::string::String` | `string` |
| `&signer`, `signer` | (omitted from params) |
| Generic `T0`, `T1`, etc. | `T0`, `T1`, etc. |

## Generic Type Parameters

For functions with generics:

```move
public fun balance<CoinType>(owner: address): u64 { ... }
```

Generated code:

```typescript
async balance<T0 = unknown>(
  arg0: string,
  typeArgs: string[]
): Promise<string> {
  // ...
}

// Usage
const balance = await coin.balance('0x123...', ['0x1::aptos_coin::AptosCoin']);
```

## Programmatic Usage

Use the parser and generator directly:

```typescript
import { ABIParser, TypeGenerator } from '@movebridge/codegen';

// Create parser for network
const parser = new ABIParser('testnet');

// Fetch ABI from chain
const abi = await parser.fetchABI('0x1::coin');

// Generate TypeScript code
const generator = new TypeGenerator(parser);
const code = generator.generateClass(abi);

// Write to file
fs.writeFileSync('./coin.ts', code);
```

### ABIParser

```typescript
const parser = new ABIParser(network: 'mainnet' | 'testnet');

// Fetch module ABI
const abi = await parser.fetchABI('0x1::coin');
// Returns: ModuleABI

// Parse Move type to TypeScript
const tsType = parser.parseType('vector<u64>');
// Returns: 'string[]'
```

### TypeGenerator

```typescript
const generator = new TypeGenerator(parser);

// Generate class from ABI
const code = generator.generateClass(abi);
// Returns: string (TypeScript code)
```

## ABI Structure

The parsed ABI has this structure:

```typescript
interface ModuleABI {
  address: string;           // Contract address
  name: string;              // Module name
  exposedFunctions: FunctionABI[];
}

interface FunctionABI {
  name: string;              // Function name
  visibility: 'public' | 'private' | 'friend';
  isEntry: boolean;          // Entry function (write)
  isView: boolean;           // View function (read)
  genericTypeParams: TypeParam[];
  params: string[];          // Parameter types
  return: string[];          // Return types
}

interface TypeParam {
  constraints: string[];     // Type constraints
}
```

## Error Handling

```typescript
import { isMovementError } from '@movebridge/core';

try {
  const abi = await parser.fetchABI('0x1::nonexistent');
} catch (error) {
  if (isMovementError(error)) {
    if (error.code === 'ABI_FETCH_FAILED') {
      console.log('Module not found');
    }
    if (error.code === 'INVALID_ARGUMENT') {
      console.log('Invalid module address format');
    }
  }
}
```

## Best Practices

1. **Generate during build** - Add codegen to your build script
2. **Commit generated files** - Include in version control for CI
3. **Regenerate on contract updates** - Keep types in sync
4. **Use specific addresses** - Generate for each contract you use

## Example Build Script

```json
{
  "scripts": {
    "codegen": "movebridge-gen -a 0x1::coin -n testnet -o ./src/types/coin.ts",
    "build": "npm run codegen && tsc"
  }
}
```

## Exports

```typescript
export { ABIParser } from './parser';
export type { ModuleABI, FunctionABI, TypeParam } from './parser';
export { TypeGenerator } from './generator';
```

## Next Steps

- [Contract Interactions Guide](/docs/guides/contracts)
- [API Reference](/docs/api/codegen/cli)
